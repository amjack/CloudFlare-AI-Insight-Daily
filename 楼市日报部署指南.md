# 🏠 楼市洞察日报 - 小白完整部署指南

> 从零开始，手把手教你搭建属于自己的楼市资讯日报平台
> 
> ⏱️ 预计耗时：20-30 分钟（首次部署）

---

## 📋 目录

1. [项目介绍](#项目介绍)
2. [准备工作清单](#准备工作清单)
3. [第一步：注册 Cloudflare 账号](#第一步注册-cloudflare-账号)
4. [第二步：注册阿里云并获取 API Key](#第二步注册阿里云并获取-api-key)
5. [第三步：配置 GitHub（可选）](#第三步配置-github)
6. [第四步：安装开发工具](#第四步安装开发工具)
7. [第五步：部署项目到 Cloudflare](#第五步部署项目到-cloudflare)
8. [第六步：测试和使用](#第六步测试和使用)
9. [如何自定义 RSS 源](#如何自定义-rss-源)
10. [常见问题解答](#常见问题解答)

---

## 项目介绍

**楼市洞察日报** 是一个自动化的房地产资讯聚合平台：

```
┌─────────────────────────────────────────────────────────────┐
│                      工作流程                                │
│                                                             │
│   RSS资讯源 ──► Cloudflare抓取 ──► AI智能处理 ──► 生成日报   │
│   (财经/楼市)    (免费服务器)      (阿里云Qwen)    (发布GitHub)│
└─────────────────────────────────────────────────────────────┘
```

**你将获得**：
- 📜 每日自动整理的楼市政策动态
- 📊 房价、成交等市场数据摘要
- 🎙️ 可直接朗读的播客脚本
- 📱 支持手机访问的网页版日报

**费用**：基本免费（AI 调用约 ¥3/月）

**特点**：
- ✅ 直接抓取 RSS 源，无需注册额外服务
- ✅ 预置多个财经/楼市 RSS 源，开箱即用
- ✅ 支持自定义添加更多 RSS 源

---

## 准备工作清单

在开始之前，请确保你有：

- [ ] 一个邮箱（用于注册各平台账号）
- [ ] 一个手机号（阿里云实名认证需要）
- [ ] 一台电脑（Windows / Mac 都可以）
- [ ] 稳定的网络连接

**需要注册的账号**（下面会一步步教你）：

| 平台 | 用途 | 是否免费 |
|-----|------|:-------:|
| Cloudflare | 运行后端服务 | ✅ 免费 |
| 阿里云 | AI 大模型 | ✅ 新人免费 |
| GitHub | 存储和发布日报 | ✅ 免费 |

> 💡 相比之前的方案，现在**不需要**注册 Folo 了！直接抓取 RSS 源，更简单。

---

## 第一步：注册 Cloudflare 账号

> Cloudflare 是一家提供免费云服务的公司，我们用它来运行后端程序。

### 1.1 打开 Cloudflare 官网

在浏览器中访问：**https://dash.cloudflare.com/sign-up**

### 1.2 创建账号

1. 输入你的 **邮箱地址**
2. 设置一个 **密码**（至少 8 位，包含字母和数字）
3. 点击 **Create Account**（创建账号）

```
┌────────────────────────────────────────┐
│         Create a Cloudflare account    │
│                                        │
│  Email: [your-email@example.com    ]   │
│                                        │
│  Password: [••••••••••••            ]  │
│                                        │
│  [      Create Account              ]  │
└────────────────────────────────────────┘
```

### 1.3 验证邮箱

1. 登录你的邮箱
2. 找到 Cloudflare 发来的验证邮件
3. 点击邮件中的 **Verify email**（验证邮箱）链接

### 1.4 跳过添加网站

注册完成后，Cloudflare 会询问你是否要添加网站：
- 点击页面左上角的 **Cloudflare** Logo
- 或者点击 **Skip** 跳过

**✅ Cloudflare 账号注册完成！**

---

## 第二步：注册阿里云并获取 API Key

> 阿里云的通义千问（Qwen）是国内领先的 AI 大模型，我们用它来生成日报摘要。
> 
> ⚠️ **请使用阿里云国内版**（aliyun.com），不要用国际版（alibabacloud.com）

### 2.1 注册阿里云账号

1. 访问阿里云官网：**https://www.aliyun.com/**
2. 点击右上角 **免费注册**

```
┌─────────────────────────────────────────────────────┐
│  阿里云官网右上角                                     │
│                                                     │
│  [登录]  [免费注册]  ← 点击这里                       │
└─────────────────────────────────────────────────────┘
```

3. 选择注册方式（推荐使用支付宝，最方便）：
   - **支付宝快捷注册**：用支付宝扫码，一键完成 ✅ 推荐
   - **手机号注册**：输入手机号，接收验证码
   - **邮箱注册**：需要验证邮箱

4. 完成实名认证（必须）：
   - 个人用户：需要身份证信息
   - 支付宝注册的用户通常会自动完成实名认证

### 2.2 进入百炼大模型平台

阿里云已将 AI 模型服务整合到「百炼」平台，请按以下步骤操作：

1. 访问百炼控制台：**https://bailian.console.aliyun.com/**

2. 首次访问会提示开通服务：
   - 点击 **立即开通**
   - 勾选服务协议
   - 点击 **确认开通**

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│          欢迎使用阿里云百炼大模型平台                  │
│                                                     │
│     百炼平台提供通义千问等多种 AI 大模型服务           │
│                                                     │
│     ☑ 我已阅读并同意《百炼服务协议》                  │
│                                                     │
│              [  立即开通  ]                          │
│                                                     │
└─────────────────────────────────────────────────────┘
```

### 2.3 获取 API Key

1. 开通成功后，进入百炼控制台
2. 点击页面顶部的 **API** 标签页
   - 或直接访问：**https://bailian.console.aliyun.com/?tab=api#/api**

```
┌─────────────────────────────────────────────────────┐
│  百炼控制台顶部导航                                   │
│                                                     │
│  [概览]  [模型广场]  [API]  [应用]  [数据]            │
│                        ↑                            │
│                    点击这里                          │
└─────────────────────────────────────────────────────┘
```

3. 在 API 管理页面，点击 **创建 API Key** 或 **创建新的 API-KEY**

4. 填写信息：
   - **API Key 名称**：输入 `楼市日报`（或任意名称）
   - 点击 **确定** 创建

5. **重要**：创建成功后，立即复制 API Key！
   - 点击 **复制** 按钮
   - 粘贴到记事本保存
   - 格式类似：`sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

```
┌─────────────────────────────────────────────────────┐
│                                                     │
│  ✅ API Key 创建成功                                 │
│                                                     │
│  API Key 名称：楼市日报                              │
│                                                     │
│  API Key：sk-a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8  │
│                                                     │
│           [复制]    ← 点击复制，立即保存！            │
│                                                     │
│  ⚠️ 此 API Key 仅显示一次，关闭后无法再次查看         │
│                                                     │
└─────────────────────────────────────────────────────┘
```

> ⚠️ **重要提醒**：API Key 只显示这一次！请务必复制保存到安全的地方。
> 如果忘记保存，只能删除后重新创建。

### 2.4 查看免费额度和模型

1. 点击顶部 **模型广场** 标签
2. 找到 **通义千问** 系列模型
3. 查看各模型的免费额度：

| 模型名称 | 免费额度 | 特点 | 推荐场景 |
|---------|---------|------|---------|
| qwen-turbo | 100万 tokens | 速度快、成本低 | 日常使用 |
| qwen-plus | 100万 tokens | 能力均衡 | **推荐使用** ✅ |
| qwen-max | 100万 tokens | 能力最强 | 深度分析 |

> 💡 **小贴士**：新用户每个模型都有 100 万 tokens 免费额度，足够用好几个月！

### 2.5 保存你的信息

请将以下信息保存到记事本，后面配置时会用到：

```
┌─────────────────────────────────────────────────────┐
│  📝 我的阿里云配置信息                               │
│                                                     │
│  API Key: sk-________________________________       │
│                                                     │
│  API 地址: https://dashscope.aliyuncs.com/compatible-mode
│                                                     │
│  模型名称: qwen-plus                                 │
└─────────────────────────────────────────────────────┘
```

**✅ 阿里云 API Key 获取完成！**

---

## 第三步：配置 GitHub

> GitHub 是全球最大的代码托管平台，我们用它来存储日报文件和托管网页。
>
> ⚠️ **此步骤是可选的**：如果你选择手动管理日报文件，可以跳过 GitHub Token 的配置。
> 但如果你想让系统自动发布日报到网页，则需要完成此步骤。

### 3.1 注册 GitHub 账号

1. 访问：**https://github.com/signup**
2. 输入邮箱，设置密码，选择用户名
3. 完成人机验证
4. 验证邮箱

### 3.2 创建仓库（Repository）

1. 登录 GitHub 后，点击右上角 **+** 号
2. 选择 **New repository**
3. 填写仓库信息：
   - **Repository name**：`realestate-daily`（或你喜欢的名字）
   - **Description**：`楼市洞察日报`
   - 选择 **Public**（公开）
   - ☑️ 勾选 **Add a README file**
4. 点击 **Create repository**

```
┌────────────────────────────────────────┐
│  Create a new repository               │
│                                        │
│  Repository name: [realestate-daily ]  │
│                                        │
│  Description: [楼市洞察日报          ]  │
│                                        │
│  ○ Public  ● Private                   │
│                                        │
│  ☑ Add a README file                   │
│                                        │
│  [      Create repository           ]  │
└────────────────────────────────────────┘
```

### 3.3 获取 Personal Access Token

这是让程序能够自动向 GitHub 提交文件的"钥匙"。

1. 点击右上角你的头像
2. 选择 **Settings**（设置）
3. 滚动到最下面，点击左侧 **Developer settings**
4. 点击 **Personal access tokens** → **Tokens (classic)**
5. 点击 **Generate new token** → **Generate new token (classic)**
6. 填写信息：
   - **Note**：`楼市日报`
   - **Expiration**：选择 `90 days` 或 `No expiration`（永不过期）
   - **Select scopes**：勾选 `repo`（整个 repo 选项）
7. 点击最下方 **Generate token**
8. **重要**：立即复制 Token 并保存到记事本
   - 格式类似：`ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - ⚠️ 这个 Token 只显示一次！

**✅ GitHub 配置完成！**

---

## 第四步：安装开发工具

> 我们需要安装一些工具来部署项目。

### 4.1 安装 Node.js

1. 访问：**https://nodejs.org/**
2. 下载 **LTS**（长期支持版）
3. 双击安装包，一路点击 **Next** 完成安装

**验证安装**：
1. 打开终端/命令行：
   - **Windows**：按 `Win + R`，输入 `cmd`，回车
   - **Mac**：按 `Cmd + Space`，输入 `Terminal`，回车
2. 输入以下命令：
   ```bash
   node --version
   ```
3. 如果显示版本号（如 `v20.10.0`），说明安装成功

### 4.2 安装 Wrangler（Cloudflare CLI）

在终端中输入：

```bash
npm install -g wrangler
```

等待安装完成（可能需要 1-2 分钟）。

**验证安装**：
```bash
wrangler --version
```

### 4.3 下载项目代码

**方法一：使用 Git（推荐）**

1. 安装 Git：访问 **https://git-scm.com/downloads** 下载安装
2. 在终端中执行：
   ```bash
   git clone https://github.com/你的用户名/realestate-daily.git
   cd realestate-daily
   ```

**方法二：直接下载**

1. 下载项目 ZIP 包
2. 解压到你喜欢的位置
3. 在终端中进入该目录：
   ```bash
   cd /path/to/realestate-daily
   ```

**✅ 开发工具安装完成！**

---

## 第五步：部署项目到 Cloudflare

### 5.1 登录 Cloudflare

在终端中执行：

```bash
wrangler login
```

会自动打开浏览器，点击 **Allow**（允许）授权。

### 5.2 创建 KV 存储

```bash
wrangler kv:namespace create "DATA_KV"
```

执行后会显示类似：
```
✨ Success!
Add the following to your wrangler.toml:
kv_namespaces = [
  { binding = "DATA_KV", id = "abc123xxxxxxxxxxxxx" }
]
```

**记录下这个 `id`（abc123xxxxxxxxxxxxx 这部分）**

### 5.3 配置 wrangler.toml

用任意文本编辑器打开项目根目录的 `wrangler.toml` 文件，修改以下内容：

```toml
# wrangler.toml

name = "realestate-daily"
main = "src/index.js"
compatibility_date = "2025-05-20"
workers_dev = true

# ⚠️ 把 id 替换成你在 5.2 步获取的 ID
kv_namespaces = [
  { binding = "DATA_KV", id = "把这里替换成你的KV_ID" }
]

[vars]
# ============ 登录设置 ============
LOGIN_USERNAME = "admin"           # 登录用户名，可以改成你喜欢的
LOGIN_PASSWORD = "你的登录密码"      # ⚠️ 设置一个强密码

# ============ 日报设置 ============
DAILY_TITLE = "楼市洞察日报"
DAILY_TITLE_MIN = " `楼市日报` "
PODCAST_TITLE = "今日楼市快报"
PODCAST_BEGIN = "大家好，欢迎收听今日楼市快报"
PODCAST_END = "以上就是今天的楼市要闻，投资有风险，购房需谨慎"

# ============ AI 模型设置 ============
USE_MODEL_PLATFORM = "OPEN"
OPEN_TRANSLATE = "false"
# ⚠️ OPENAI_API_KEY 不要写在这里！请在 Cloudflare Dashboard 配置 Secrets（更安全）
# 详见下方「5.4 配置环境变量（重要！）」
OPENAI_API_URL = "https://dashscope.aliyuncs.com/compatible-mode"
DEFAULT_OPEN_MODEL = "qwen-plus"

# ============ GitHub 设置（可选）============
# 如果你想手动提交代码，可以不配置 GitHub Token
# GITHUB_TOKEN = "ghp_你的GitHubToken"
GITHUB_REPO_OWNER = "你的GitHub用户名"     # ⚠️ 替换成你的用户名
GITHUB_REPO_NAME = "realestate-daily"     # ⚠️ 替换成你的仓库名
GITHUB_BRANCH = "main"

# ============ RSS 数据源设置 ============
# 已预置多个财经/楼市 RSS 源，一般无需修改
# 如需自定义，请参考「如何自定义 RSS 源」章节
RSS_FILTER_DAYS = 2
RSS_REALESTATE_NEWS = "https://rsshub.app/cls/depth/1000,https://rsshub.app/wallstreetcn/news/global"
RSS_FINANCE_NEWS = "https://rsshub.app/36kr/newsflashes,https://rsshub.app/huxiu/article"
RSS_POLICY_NEWS = ""
RSS_GENERAL_NEWS = "https://rsshub.app/thepaper/channel/25950"
```

### 5.4 配置环境变量（重要！）

> ⚠️ **为什么不把 API Key 写在 wrangler.toml 里？**
> 
> wrangler.toml 会上传到 GitHub，如果里面包含 API Key，就会泄露！
> 
> Cloudflare 提供了「Secrets」功能，可以安全地存储敏感信息。

#### 方法一：通过 Cloudflare Dashboard 配置（推荐 👍）

1. 先完成 5.5 步的部署（`wrangler deploy`）
2. 打开 Cloudflare Dashboard：**https://dash.cloudflare.com/**
3. 点击左侧 **Workers & Pages**
4. 找到并点击你的 Worker（`realestate-daily`）
5. 点击 **Settings**（设置）标签
6. 点击 **Variables**（变量）
7. 在 **Environment Variables** 部分，点击 **Add variable**

添加以下环境变量：

| 变量名 | 值 | 类型 |
|-------|-----|------|
| `OPENAI_API_KEY` | `sk-你的阿里云APIKey` | 🔒 Encrypt（加密） |
| `GITHUB_TOKEN`（可选） | `ghp_你的Token` | 🔒 Encrypt（加密） |

```
┌─────────────────────────────────────────────────────────────┐
│  Settings > Variables > Environment Variables               │
│                                                             │
│  Variable name: [ OPENAI_API_KEY                     ]      │
│                                                             │
│  Value:         [ sk-79ddf3fecefa43a4a67e4b925ff31  ]      │
│                                                             │
│  ☑ Encrypt  ← 勾选这个，密钥会加密存储                       │
│                                                             │
│  [  Save  ]                                                 │
└─────────────────────────────────────────────────────────────┘
```

> 💡 勾选「Encrypt」后，API Key 会加密存储，即使别人能看到你的 Worker 设置也看不到密钥明文。

#### 方法二：通过命令行配置

如果你喜欢用命令行：

```bash
# 配置阿里云 API Key（会提示你输入，不会显示在屏幕上）
wrangler secret put OPENAI_API_KEY

# 配置 GitHub Token（可选）
wrangler secret put GITHUB_TOKEN
```

执行后会提示：
```
Enter a secret value: › ****************************
🌀 Creating the secret for the Worker "realestate-daily"
✨ Success! Uploaded secret OPENAI_API_KEY
```

> 💡 **小贴士**：Secrets 配置后，需要重新部署才能生效：`wrangler deploy`

### 5.5 本地测试（可选）

```bash
wrangler dev
```

如果看到类似输出，说明运行成功：
```
⎔ Starting local server...
Ready on http://localhost:8787
```

在浏览器中访问 **http://localhost:8787/login** 测试登录。

按 `Ctrl + C` 停止本地服务。

### 5.6 部署到云端

```bash
wrangler deploy
```

部署成功后会显示：
```
✨ Deployment complete!
Your worker is live at: https://realestate-daily.你的用户名.workers.dev
```

**记录下这个网址，这就是你的楼市日报后台！**

### 5.7 配置 Secrets（部署后必做！）

> ⚠️ **重要**：部署后，必须配置 API Key 才能使用 AI 功能！

按照 5.4 节的说明，通过 Cloudflare Dashboard 或命令行配置：
- `OPENAI_API_KEY`：你的阿里云 API Key

配置完成后，重新部署使配置生效：
```bash
wrangler deploy
```

**✅ 部署完成！**

---

## 第六步：测试和使用

### 6.1 首次登录

1. 访问你的网址：`https://realestate-daily.xxx.workers.dev/login`
2. 输入你在配置文件中设置的用户名和密码
3. 登录成功后进入内容选择页面

### 6.2 抓取今日数据

1. 点击 **抓取并写入今日数据**
2. 等待 10-30 秒，数据抓取完成
3. 页面会自动刷新，显示今日的楼市资讯

> 💡 数据来自预置的 RSS 源，无需任何额外配置！

### 6.3 生成日报

1. 浏览各分类的资讯（楼市资讯、财经资讯等）
2. 勾选你想纳入日报的内容（建议选 5-15 条）
3. 点击 **从选中内容生成 AI 日报**
4. 等待 AI 处理（约 20-60 秒）
5. 生成完成后可以预览日报内容

### 6.4 生成播客脚本（可选）

1. 在日报生成页面，点击 **生成播客脚本**
2. AI 会自动将日报改写为口播稿

### 6.5 发布到 GitHub

1. 点击 **保存日报到 GitHub**
2. 日报会自动提交到你的 GitHub 仓库
3. 可以通过 GitHub Pages 对外展示

---

## 如何自定义 RSS 源

项目预置了多个财经/楼市相关的 RSS 源，如果你想添加或修改，可以按以下方法操作。

### 默认 RSS 源说明

| 配置项 | 说明 | 预置源 |
|-------|------|-------|
| `RSS_REALESTATE_NEWS` | 楼市资讯 | 财联社、华尔街见闻 |
| `RSS_FINANCE_NEWS` | 财经资讯 | 36氪、虎嗅 |
| `RSS_POLICY_NEWS` | 政策动态 | 默认为空 |
| `RSS_GENERAL_NEWS` | 综合资讯 | 澎湃财经 |

### 添加新的 RSS 源

1. 打开 `wrangler.toml` 文件
2. 找到对应的配置项
3. 添加 RSS 地址（多个用英文逗号分隔）

```toml
# 示例：添加更多财经源
RSS_FINANCE_NEWS = "https://rsshub.app/36kr/newsflashes,https://rsshub.app/huxiu/article,https://rsshub.app/jiemian/list/4"
```

### 推荐的 RSSHub 源

RSSHub 是一个开源项目，可以为很多网站生成 RSS。以下是一些推荐的源：

```
财经类：
├─ 财联社深度: https://rsshub.app/cls/depth/1000
├─ 华尔街见闻: https://rsshub.app/wallstreetcn/news/global
├─ 36氪快讯: https://rsshub.app/36kr/newsflashes
├─ 36氪深度: https://rsshub.app/36kr/news/latest
├─ 虎嗅: https://rsshub.app/huxiu/article
├─ 澎湃财经: https://rsshub.app/thepaper/channel/25950
├─ 界面新闻: https://rsshub.app/jiemian/list/4
└─ 经济观察报: https://rsshub.app/eeo/yaowen

科技类：
├─ 少数派: https://rsshub.app/sspai/index
└─ IT之家: https://rsshub.app/ithome/it

更多源请查看 RSSHub 文档：https://docs.rsshub.app/
```

### 使用其他 RSSHub 实例

如果默认的 `rsshub.app` 访问不稳定，可以换成其他公共实例：

```toml
# 将 rsshub.app 替换为其他实例
RSS_REALESTATE_NEWS = "https://rsshub.rssforever.com/cls/depth/1000"
# 或
RSS_REALESTATE_NEWS = "https://hub.slarker.me/cls/depth/1000"
```

### 修改后重新部署

修改配置后，需要重新部署：

```bash
wrangler deploy
```

---

## 常见问题解答

### ❓ Q1: wrangler login 打不开浏览器？

**解决方案**：
1. 手动复制终端中显示的 URL
2. 粘贴到浏览器中打开
3. 完成授权

### ❓ Q2: 部署时报错 "KV namespace not found"？

**解决方案**：
1. 确认 `wrangler.toml` 中的 KV ID 正确
2. 重新执行 `wrangler kv:namespace create "DATA_KV"`
3. 用新的 ID 更新配置文件

### ❓ Q3: AI 生成失败，提示 API 错误？

**解决方案**：
1. 检查阿里云 API Key 是否正确
2. 确认 DashScope 服务已开通
3. 检查免费额度是否用完

### ❓ Q4: RSS 数据抓取失败？

**解决方案**：
1. 检查网络连接
2. RSSHub 可能暂时不可用，尝试更换实例
3. 某些 RSS 源可能已失效，尝试更换其他源

### ❓ Q5: GitHub 提交失败？

**解决方案**：
1. 检查 GitHub Token 是否过期
2. 确认 Token 有 `repo` 权限
3. 检查仓库名称是否正确

### ❓ Q6: 如何添加更多 RSS 源？

**解决方案**：
1. 参考「如何自定义 RSS 源」章节
2. 在 `wrangler.toml` 中添加 RSS 地址
3. 多个地址用英文逗号分隔
4. 重新部署：`wrangler deploy`

### ❓ Q7: 抓取到的数据为空？

**解决方案**：
1. 确认 RSS 源地址正确且可访问
2. 检查 `RSS_FILTER_DAYS` 设置（默认抓取最近 2 天）
3. 某些 RSS 源可能更新不频繁，尝试增大天数或更换源

---

## 📊 成本说明

| 服务 | 免费额度 | 超出后费用 |
|-----|---------|-----------|
| Cloudflare Workers | 10万次/天 | 基本用不完 |
| Cloudflare KV | 10万读/天 | 基本用不完 |
| 阿里云 Qwen | 100万 tokens | ¥0.8/百万 |
| GitHub | 无限制 | 免费 |
| RSSHub | 无限制 | 免费 |

**实际月费用：约 ¥0-3**（取决于使用频率）

---

## 🎉 恭喜！

如果你按照以上步骤完成了部署，现在你已经拥有了一个属于自己的楼市资讯聚合平台！

**每日使用流程**：
1. 登录后台
2. 点击抓取今日数据（无需任何配置！）
3. 勾选感兴趣的内容
4. 一键生成日报
5. 发布到 GitHub

---

## 📞 获取帮助

如果遇到问题：
1. 仔细阅读本文档的「常见问题解答」
2. 检查 Cloudflare Dashboard 中的日志
3. 在 GitHub Issues 中提问

**祝你使用愉快！投资有风险，购房需谨慎。** 🏠
